# 🧠 Unity Enemy Crowd Movement Algorithms

> 뱀파이어 서바이벌류와 같이 수많은 적 유닛이 몰려드는 상황에서  
> **자연스럽고 효율적으로 적을 이동시키고 겹침을 방지하는 알고리즘**을  
> 방식별로 흐름 중심으로 정리합니다.

---

## 📦 방식별 처리 과정 흐름

---

### 1. 🧱 RigidBody 방식 (Unity 물리 시스템 사용)

#### ▶ 처리 순서:

1. 적에게 `Rigidbody2D`와 `Collider2D`를 부착한다.
2. 물리적 충돌 반응은 Unity 엔진이 자동 계산한다.
3. 적은 `AddForce()`나 `velocity`로 이동한다.
4. 겹치면 반발력이 작동하여 자동 분리된다.

#### ✅ 특징:
- ✅ 구현이 매우 쉽다.
- ❌ 유닛 수 증가 시 성능 급락 (물리 충돌 처리량 폭증).
- ❌ 튕김, 떨림, 겹침 해소 실패 등 시각적 품질 낮음.

---

### 2. 🧽 후처리 방식 (사후 밀어내기)

#### ▶ 처리 순서:

1. 모든 적이 플레이어를 향해 이동한다.
2. 이동이 끝난 후, 모든 적 쌍에 대해 **겹치는지 검사**한다.
3. 겹친 경우 → 각자 **반대 방향으로 살짝씩 밀어낸다**.
4. 이 과정을 2~3회 반복해 안정화한다.

#### ✅ 특징:
- ✅ 제어가 쉽고 직관적이다.
- ❌ O(n²) 검사로 성능 낮음.
- ❌ 밀림 누적 → 부자연스러운 움직임.

---

### 3. 🚧 이동 예측 방식 (사전 회피)

#### ▶ 처리 순서:

1. 적이 플레이어를 향한 방향을 계산한다.
2. **예상 위치**에 적이 있는지 미리 검사한다.
3. 겹칠 경우 → 방향을 살짝 틀거나, 이동을 취소한다.
4. 틀어도 안 되면 멈춘다.

#### ✅ 특징:
- ✅ 충돌을 미리 방지할 수 있다.
- ❌ 멈추는 적이 많아지면 혼잡/정체 발생.
- ❌ 회피 방향 설정 반복 검사 필요.

---

### 4. 🔮 포텐셜 필드 방식 (자연스러운 유닛 흐름)

#### ▶ 처리 순서:

1. 적은 플레이어에게 끌리는 **끌림 벡터 (attract)**를 계산한다.
2. 주변의 적들을 탐색하고, **밀려나는 힘 (repulse)**을 합산한다.
3. 두 벡터를 더해 최종 이동 방향을 만든다.
4. 해당 방향으로 이동한다.

#### ⛏ 최적화 보완:

- `Spatial Hashing`으로 검사 범위 축소
- `Influence Radius`로 멀리 있는 적 무시
- `ClampMagnitude`로 튀는 힘 방지
- `거리순 처리`로 앞 적 먼저 고정, 뒤는 회피

#### ✅ 특징:
- ✅ 매우 자연스러운 움직임
- ✅ AI처럼 보이는 이동
- ❌ 구현 복잡, 초기 성능은 낮음 (최적화 필수)

---

### 5. 🧠 혼합 방식 (포텐셜 + 예측 + 최소 보정)

#### ▶ 처리 순서:

1. 포텐셜 필드로 기본 이동 방향 계산
2. 예상 위치에 충돌이 있다면 → 회피 방향 선택
3. 마지막으로 겹치면 소폭 위치 조정 (후처리)

#### ✅ 특징:
- ✅ 자연스러움 + 충돌 안정성 + 유연성
- ✅ 프레임별 안정된 움직임 유지
- ❌ 설계/구현 난이도는 가장 높음

---

## 🧭 방식 선택 요약

| 방식 | 자연스러움 | 성능 | 추천 대상 |
|------|-------------|--------|-------------|
| RigidBody | ❌ 낮음 | ❌ 낮음 | 실험/프로토타입 |
| 후처리 | ❌ 중간 | ❌ 낮음 | 간단한 경우 |
| 예측 | ⭕ 중간 | ⭕ 중간 | 밀집도 낮은 게임 |
| 포텐셜 | ✅ 높음 | ⭕ (최적화 시) | 실전 적용에 적합 |
| 혼합 | ✅ 최고 | ✅ 최고 | 고급 구현/출시작 |
